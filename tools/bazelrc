################################################################################
# Defaults

# Group tasks into fewer processes so the OS scheduler can handle them better.
startup --batch_cpu_scheduling

# Always generate explanations.
build --explain /tmp/explain.txt --verbose_explanations

# Always show output from failing tests.
test --test_output=errors

# Remove external content quickly when cleaning.
clean --expunge_async

# Build with kraken; test the same way we do in CI.
build --config=kraken -X CppLink
test --config=standalone

# Omit unnecessary runfiles trees to speed up builds.
build --config=norunfiles
test --config=norunfiles

################################################################################
# Configs

# Ensure builds and tests happen in a reproducible environment.
build:sandboxed --spawn_strategy=sandboxed --genrule_strategy=sandboxed
test:sandboxed --spawn_strategy=sandboxed --genrule_strategy=sandboxed

# Turn off slow build and test isolation.
build:standalone --spawn_strategy=standalone --genrule_strategy=standalone
test:standalone --spawn_strategy=standalone --genrule_strategy=standalone

# Build runfiles forests for all binary targets.
build:runfiles --build_runfile_links
test:runfiles --build_runfile_links

# Only build runfiles forests for explicitly requested binary targets.
build:norunfiles --nobuild_runfile_links
test:norunfiles --nobuild_runfile_links

# Make it easy to request explanations.
build:explain --explain /tmp/explain.txt --verbose_explanations
